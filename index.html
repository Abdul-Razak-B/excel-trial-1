<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Excel Trial | Employee Management</title>
        <!-- Suitable Browser Icon (Favicon) - Animated via JS pulse -->
        <link id="favicon" rel="icon"
            href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' rx='25' fill='%234f46e5'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='central' text-anchor='middle' font-family='Plus Jakarta Sans, sans-serif' font-size='65' font-weight='bold' fill='white'%3EE%3C/text%3E%3C/svg%3E">

        <script src="https://cdn.tailwindcss.com"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
        <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap"
            rel="stylesheet">
        <style>
            :root {
                --primary: #4f46e5;
                --primary-dark: #4338ca;
            }

            body {
                font-family: 'Plus Jakarta Sans', sans-serif;
                scroll-behavior: smooth;
                background: #f8fafc;
                overflow-x: hidden;
            }

            /* Responsive Custom Scrollbar */
            ::-webkit-scrollbar {
                width: 6px;
            }

            @media (min-width: 768px) {
                ::-webkit-scrollbar {
                    width: 10px;
                }
            }

            ::-webkit-scrollbar-track {
                background: #f1f5f9;
            }

            ::-webkit-scrollbar-thumb {
                background: #cbd5e1;
                border-radius: 10px;
                border: 2px solid #f1f5f9;
            }

            ::-webkit-scrollbar-thumb:hover {
                background: #4f46e5;
            }

            .nav-glass {
                background: rgba(255, 255, 255, 0.8);
                backdrop-filter: blur(12px);
                border-bottom: 1px solid rgba(255, 255, 255, 0.3);
            }

            @keyframes fadeInUp {
                from {
                    opacity: 0;
                    transform: translateY(20px);
                }

                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            .animate-fade-up {
                animation: fadeInUp 0.8s ease-out forwards;
            }

            .employee-card {
                transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            }

            .employee-card:hover {
                transform: translateY(-8px);
                box-shadow: 0 25px 30px -5px rgba(0, 0, 0, 0.08), 0 15px 15px -5px rgba(0, 0, 0, 0.03);
            }

            /* 3D Typewriter Responsive Sizing */
            .typewriter-3d {
                text-shadow: 1px 1px 0px #c7d2fe, 2px 2px 0px #818cf8, 3px 3px 0px #4f46e5;
                position: relative;
            }

            @media (max-width: 640px) {
                .typewriter-3d {
                    text-shadow: 1px 1px 0px #c7d2fe, 1.5px 1.5px 0px #818cf8, 2px 2px 0px #4f46e5;
                }
            }

            .cursor-blink {
                display: inline-block;
                width: 3px;
                height: 0.9em;
                background-color: #4f46e5;
                margin-left: 2px;
                vertical-align: middle;
                animation: blink 0.8s infinite;
            }

            @keyframes blink {
                50% {
                    opacity: 0;
                }
            }

            @media print {
                body {
                    background: white !important;
                    -webkit-print-color-adjust: exact !important;
                    print-color-adjust: exact !important;
                }

                nav,
                section,
                footer,
                #print-modal,
                #edit-modal,
                .no-print {
                    display: none !important;
                }

                #print-area {
                    display: block !important;
                    position: absolute;
                    left: 0;
                    top: 0;
                    width: 210mm;
                    min-height: 297mm;
                    padding: 15mm;
                    margin: 0;
                    background: white !important;
                }
            }

            .modal-overlay {
                background: rgba(15, 23, 42, 0.6);
                backdrop-filter: blur(4px);
                transition: opacity 0.3s ease;
            }

            .btn-shine {
                position: relative;
                overflow: hidden;
            }

            .btn-shine::after {
                content: '';
                position: absolute;
                top: -50%;
                left: -50%;
                width: 200%;
                height: 200%;
                background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.3), transparent);
                transform: rotate(45deg);
                transition: 0.5s;
            }

            .btn-shine:hover::after {
                left: 100%;
                top: 100%;
            }
        </style>
    </head>

    <body class="text-slate-800">

        <!-- Navigation -->
        <nav class="fixed top-0 w-full z-50 nav-glass">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center h-16 md:h-20">
                    <div class="flex items-center space-x-2 shrink-0">
                        <div id="nav-logo"
                            class="w-8 h-8 md:w-10 md:h-10 bg-indigo-600 rounded-lg md:rounded-xl flex items-center justify-center text-white font-bold text-lg md:text-xl shadow-lg transition-opacity duration-75">
                            E</div>
                        <span class="text-lg md:text-2xl font-bold tracking-tight text-slate-900 truncate">Excel
                            Trial</span>
                    </div>
                    <div class="flex items-center space-x-2 md:space-x-4">
                        <button onclick="document.getElementById('file-upload').click()"
                            class="text-xs md:text-sm bg-indigo-600 text-white px-3 md:px-5 py-2 md:py-2.5 rounded-full hover:bg-indigo-700 transition-all shadow-md active:scale-95 whitespace-nowrap">Import</button>
                        <button onclick="exportToExcel()"
                            class="text-xs md:text-sm bg-slate-900 text-white px-3 md:px-5 py-2 md:py-2.5 rounded-full hover:bg-slate-800 transition-all shadow-md active:scale-95 hidden sm:block">Export</button>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Hero Section -->
        <section id="hero" class="pt-24 md:pt-40 pb-16 md:pb-24 px-4">
            <div class="max-w-7xl mx-auto text-center">
                <h1
                    class="text-3xl sm:text-5xl md:text-7xl font-extrabold text-slate-900 mb-6 animate-fade-up leading-tight">
                    Manage Employee Records <br class="hidden sm:block">
                    <span id="typewriter-text"
                        class="text-transparent bg-clip-text bg-gradient-to-r from-indigo-600 to-violet-600 typewriter-3d"></span><span
                        class="cursor-blink"></span>
                </h1>
                <p class="text-sm md:text-lg text-slate-600 max-w-2xl mx-auto mb-8 md:mb-12 animate-fade-up"
                    style="animation-delay: 0.2s">
                    Seamlessly upload spreadsheet data, modify records in the browser, and generate professional
                    A4-ready records for printing.
                </p>
                <div class="flex flex-col sm:flex-row justify-center gap-4 animate-fade-up"
                    style="animation-delay: 0.4s">
                    <input type="file" id="file-upload" class="hidden" accept=".xlsx, .xls">
                    <button onclick="document.getElementById('file-upload').click()"
                        class="btn-shine bg-slate-900 text-white px-6 md:px-8 py-3.5 md:py-4 rounded-xl md:rounded-2xl font-bold shadow-xl hover:shadow-slate-200 transition-all flex items-center justify-center space-x-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M4 16v1a2 2 0 002 2h12a2 2 0 002-2v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
                        </svg>
                        <span>Upload database.xlsx</span>
                    </button>
                    <button onclick="generateSampleExcel()"
                        class="bg-white border-2 border-slate-200 text-slate-700 px-6 md:px-8 py-3.5 md:py-4 rounded-xl md:rounded-2xl font-bold hover:bg-slate-50 transition-all">
                        Get Template
                    </button>
                </div>
            </div>
        </section>

        <!-- Data Section -->
        <section id="data-section" class="py-12 md:py-20 bg-white min-h-screen">
            <div class="max-w-7xl mx-auto px-4">
                <div class="flex flex-col lg:flex-row lg:items-center justify-between mb-8 md:mb-16 gap-6">
                    <div class="text-center lg:text-left">
                        <h2 class="text-2xl md:text-4xl font-bold text-slate-900">Employee Profiles</h2>
                        <p class="text-slate-500 text-sm md:text-base">Live browser-based spreadsheet editor</p>
                    </div>
                    <div class="flex flex-col sm:flex-row gap-3 w-full lg:max-w-2xl">
                        <div class="relative flex-grow">
                            <input type="text" id="search-input" onkeyup="filterRecords()"
                                placeholder="Search name or city..."
                                class="w-full pl-10 md:pl-12 pr-4 py-3 md:py-4 rounded-xl border border-slate-100 bg-slate-50 focus:bg-white focus:ring-4 focus:ring-indigo-50 focus:border-indigo-500 transition-all outline-none text-sm md:text-base">
                            <svg class="w-5 h-5 text-slate-400 absolute left-3.5 md:left-4 top-3 md:top-4.5" fill="none"
                                stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                            </svg>
                        </div>
                        <button onclick="clearData()"
                            class="px-4 py-3 md:py-4 bg-red-50 text-red-600 rounded-xl hover:bg-red-100 transition-colors font-bold flex items-center justify-center space-x-2 shrink-0">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                            </svg>
                            <span class="text-sm">Clear All</span>
                        </button>
                    </div>
                </div>

                <div id="cards-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-10">
                    <!-- Cards injected via JS -->
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="bg-slate-900 text-slate-400 py-10 md:py-16">
            <div class="max-w-7xl mx-auto px-4 text-center">
                <div class="flex justify-center items-center space-x-2 mb-6 md:mb-8">
                    <div class="w-8 h-8 bg-indigo-600 rounded-lg flex items-center justify-center text-white font-bold">
                        E</div>
                    <span class="text-lg md:text-xl font-bold text-white">Excel Trial</span>
                </div>
                <p class="mb-4 text-xs md:text-sm">Enterprise Employee Record Portal</p>
                <div class="flex flex-wrap justify-center gap-4 md:gap-8 mb-8 text-xs md:text-sm">
                    <a href="#" class="hover:text-white transition-colors">Privacy Policy</a>
                    <a href="#" class="hover:text-white transition-colors">Terms of Service</a>
                    <a href="#" class="hover:text-white transition-colors">Contact Support</a>
                </div>
                <p class="text-[10px] md:text-xs text-slate-500">&copy; 2024 Excel Trial Inc. Optimized for all devices.
                </p>
            </div>
        </footer>

        <!-- Edit Record Modal -->
        <div id="edit-modal"
            class="hidden fixed inset-0 z-[100] flex items-center justify-center p-4 modal-overlay overflow-y-auto">
            <div class="bg-white rounded-2xl md:rounded-[2.5rem] shadow-2xl max-w-lg w-full p-6 md:p-10 transform transition-all scale-95 opacity-0 duration-300 max-h-[90vh] overflow-y-auto"
                id="edit-modal-content">
                <div class="flex items-center justify-between mb-6 md:mb-8 sticky top-0 bg-white pb-2">
                    <div>
                        <h3 class="text-xl md:text-2xl font-bold text-slate-900">Edit Information</h3>
                        <p class="text-xs md:text-sm text-slate-500">Update employee details</p>
                    </div>
                    <button onclick="closeEditModal()"
                        class="w-8 h-8 md:w-10 md:h-10 flex items-center justify-center bg-slate-50 text-slate-400 hover:text-slate-600 rounded-full transition-colors">
                        <svg class="w-5 h-5 md:w-6 md:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>

                <form id="edit-form" class="space-y-4 md:space-y-6" onsubmit="event.preventDefault(); saveEdit();">
                    <input type="hidden" id="edit-index">
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 md:gap-6">
                        <div class="space-y-1.5 md:space-y-2">
                            <label
                                class="text-[10px] md:text-xs font-bold text-slate-500 uppercase tracking-widest">Employee
                                ID</label>
                            <input type="text" id="edit-id"
                                class="w-full px-4 py-2.5 md:py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:bg-white outline-none transition-all text-sm">
                        </div>
                        <div class="space-y-1.5 md:space-y-2">
                            <label
                                class="text-[10px] md:text-xs font-bold text-slate-500 uppercase tracking-widest">Full
                                Name</label>
                            <input type="text" id="edit-name"
                                class="w-full px-4 py-2.5 md:py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:bg-white outline-none transition-all text-sm">
                        </div>
                    </div>
                    <div class="space-y-1.5 md:space-y-2">
                        <label
                            class="text-[10px] md:text-xs font-bold text-slate-500 uppercase tracking-widest">Father's
                            Name</label>
                        <input type="text" id="edit-father"
                            class="w-full px-4 py-2.5 md:py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:bg-white outline-none transition-all text-sm">
                    </div>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 md:gap-6">
                        <div class="space-y-1.5 md:space-y-2">
                            <label
                                class="text-[10px] md:text-xs font-bold text-slate-500 uppercase tracking-widest">Designation</label>
                            <input type="text" id="edit-designation"
                                class="w-full px-4 py-2.5 md:py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:bg-white outline-none transition-all text-sm">
                        </div>
                        <div class="space-y-1.5 md:space-y-2">
                            <label
                                class="text-[10px] md:text-xs font-bold text-slate-500 uppercase tracking-widest">City</label>
                            <input type="text" id="edit-city"
                                class="w-full px-4 py-2.5 md:py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:bg-white outline-none transition-all text-sm">
                        </div>
                    </div>
                    <div class="pt-4">
                        <button type="submit"
                            class="w-full bg-indigo-600 text-white font-bold py-3.5 md:py-4 rounded-xl md:rounded-2xl hover:bg-indigo-700 transition-all shadow-lg flex items-center justify-center space-x-2 text-sm md:text-base">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M5 13l4 4L19 7" />
                            </svg>
                            <span>Save Changes</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Print Confirmation Modal -->
        <div id="print-modal" class="hidden fixed inset-0 z-[100] flex items-center justify-center p-4 modal-overlay">
            <div class="bg-white rounded-2xl md:rounded-3xl shadow-2xl max-w-xs md:max-w-sm w-full p-6 md:p-8 transform transition-all scale-95 opacity-0 duration-300 text-center"
                id="modal-content">
                <div
                    class="w-12 h-12 md:w-16 md:h-16 bg-indigo-100 text-indigo-600 rounded-full flex items-center justify-center mx-auto mb-4 md:mb-6">
                    <svg class="w-6 h-6 md:w-8 md:h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2-2H7a2 2 0 00-2 2v4m14 0h2" />
                    </svg>
                </div>
                <h3 class="text-xl md:text-2xl font-bold text-slate-900 mb-2">Print Record?</h3>
                <p class="text-sm text-slate-500 mb-6 md:mb-8 leading-relaxed">Proceed to generate A4 printable document
                    for <span id="target-employee" class="font-bold text-slate-800"></span>?</p>
                <div class="flex flex-col space-y-3">
                    <button onclick="executePrint()"
                        class="w-full bg-indigo-600 text-white font-bold py-3.5 rounded-xl hover:bg-indigo-700 transition-all shadow-lg text-sm md:text-base">Confirm
                        & Print</button>
                    <button onclick="closeModal()"
                        class="w-full bg-slate-100 text-slate-500 font-bold py-3.5 rounded-xl hover:bg-slate-200 transition-all text-sm md:text-base">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Hidden Print Container -->
        <div id="print-area" class="hidden"></div>

        <script>
            let employeeData = [];
            let currentPrintTarget = null;
            let currentPrintImage = "";

            const pexelsPortraitIds = [
                '2379004', '415829', '1222271', '774909', '1681010',
                '1130626', '91227', '1516680', '733872', '1181682',
                '3775168', '3785079', '2182970', '1587014', '3777931'
            ];

            // --- TYPEWRITER LOGIC ---
            const textToType = "From Any Spreadsheet";
            let textIndex = 0;
            let isDeleting = false;

            function startTypewriter() {
                const currentText = textToType;
                const fullText = currentText.substring(0, textIndex);
                document.getElementById('typewriter-text').textContent = fullText;

                let typingSpeed = isDeleting ? 40 : 120;
                if (!isDeleting && textIndex === currentText.length) {
                    typingSpeed = 2500;
                    isDeleting = true;
                } else if (isDeleting && textIndex === 0) {
                    isDeleting = false;
                    typingSpeed = 600;
                }

                textIndex += isDeleting ? -1 : 1;
                setTimeout(startTypewriter, typingSpeed);
            }

            // --- FAVICON & NAV LOGO PULSE ---
            let faviconOpacity = 1;
            let faviconDirection = -0.04;

            function animateFavicon() {
                const favicon = document.getElementById('favicon');
                const navLogo = document.getElementById('nav-logo');
                faviconOpacity += faviconDirection;

                if (faviconOpacity <= 0.3 || faviconOpacity >= 1) {
                    faviconDirection *= -1;
                }

                favicon.href = `data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' rx='25' fill='%234f46e5' fill-opacity='${faviconOpacity}'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='central' text-anchor='middle' font-family='Plus Jakarta Sans, sans-serif' font-size='65' font-weight='bold' fill='white' fill-opacity='${faviconOpacity}'%3EE%3C/text%3E%3C/svg%3E`;
                if (navLogo) navLogo.style.opacity = faviconOpacity;
            }

            // --- EXCEL & DATA LOGIC ---
            document.getElementById('file-upload').addEventListener('change', function (e) {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = function (evt) {
                    try {
                        const data = new Uint8Array(evt.target.result);
                        const workbook = XLSX.read(data, { type: 'array' });
                        const worksheet = workbook.Sheets[workbook.SheetNames[0]];
                        const jsonData = XLSX.utils.sheet_to_json(worksheet);

                        if (!jsonData.length) throw new Error("File empty.");
                        employeeData = jsonData;
                        renderCards(employeeData);
                        document.getElementById('data-section').scrollIntoView({ behavior: 'smooth' });
                    } catch (error) {
                        alert("Import failed: " + error.message);
                    }
                };
                reader.readAsArrayBuffer(file);
            });

            function generateSampleExcel() {
                const sampleData = [
                    { ID: "AR-2001", Name: "Abdul Razak", "Father's Name": "Abdul Hakeem", Designation: "Senior Web Developer", City: "Daharki" },
                    { ID: "AN-2002", Name: "Abdul Nasir", "Father's Name": "Abdul Hakeem", Designation: "QA Officer", City: "Karachi" }
                ];
                const ws = XLSX.utils.json_to_sheet(sampleData);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, "Sheet1");
                XLSX.writeFile(wb, "database.xlsx");
            }

            function exportToExcel() {
                if (!employeeData.length) return alert("No data.");
                const ws = XLSX.utils.json_to_sheet(employeeData);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, "Sheet1");
                XLSX.writeFile(wb, "modified_records.xlsx");
            }

            function clearData() {
                employeeData = [];
                renderCards([]);
            }

            // --- UI RENDER ---
            function renderCards(data) {
                const container = document.getElementById('cards-container');
                if (!data.length) {
                    container.innerHTML = `<div class="col-span-full py-20 text-center bg-slate-50 rounded-3xl border-2 border-dashed border-slate-200"><p class="text-slate-400">No records found. Import a file to begin.</p></div>`;
                    return;
                }

                container.innerHTML = data.map((emp, index) => {
                    const pexelsId = pexelsPortraitIds[index % pexelsPortraitIds.length];
                    const imageUrl = `https://images.pexels.com/photos/${pexelsId}/pexels-photo-${pexelsId}.jpeg?auto=compress&cs=tinysrgb&w=300&h=300&fit=crop`;

                    return `
                <div class="employee-card bg-white p-6 md:p-10 rounded-[1.5rem] md:rounded-[2.5rem] border border-slate-100 shadow-sm relative group overflow-hidden animate-fade-up">
                    <div class="absolute -top-12 -right-12 w-48 h-48 bg-indigo-50 rounded-full blur-3xl group-hover:bg-indigo-100 transition-colors"></div>
                    <div class="relative z-10">
                        <div class="flex items-center space-x-4 md:space-x-6 mb-6 md:mb-8">
                            <div class="w-16 h-16 md:w-20 md:h-20 bg-slate-100 rounded-2xl md:rounded-3xl overflow-hidden shadow-lg border-2 border-white relative shrink-0">
                                <img src="${imageUrl}" alt="${emp.Name}" class="w-full h-full object-cover">
                            </div>
                            <div class="overflow-hidden">
                                <h4 class="font-bold text-slate-900 text-lg md:text-2xl leading-tight mb-1 truncate">${emp.Name || 'N/A'}</h4>
                                <span class="text-[10px] md:text-xs font-bold text-indigo-600 bg-indigo-50 px-2 py-1 rounded-full uppercase truncate">${emp.ID || 'ID-?'}</span>
                            </div>
                        </div>
                        <div class="space-y-3 md:space-y-5 mb-8 md:mb-10 text-sm md:text-lg">
                            <div class="flex items-start space-x-3"><span class="text-slate-400 w-20 shrink-0 text-xs md:text-sm font-medium">Father:</span><span class="text-slate-800 font-semibold truncate">${emp["Father's Name"] || '-'}</span></div>
                            <div class="flex items-start space-x-3"><span class="text-slate-400 w-20 shrink-0 text-xs md:text-sm font-medium">Role:</span><span class="text-slate-800 font-semibold truncate">${emp.Designation || '-'}</span></div>
                            <div class="flex items-start space-x-3"><span class="text-slate-400 w-20 shrink-0 text-xs md:text-sm font-medium">City:</span><span class="text-slate-800 font-semibold truncate">${emp.City || '-'}</span></div>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="openEditModal(${index})" class="flex-1 bg-slate-50 text-slate-600 py-3 rounded-xl font-bold text-xs md:text-sm flex items-center justify-center space-x-2 border border-slate-200 hover:bg-slate-100 transition-all">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/></svg>
                                <span>Edit</span>
                            </button>
                            <button onclick="confirmPrintByIndex(${index})" class="bg-slate-900 text-white p-3 rounded-xl hover:bg-indigo-600 transition-all active:scale-95">
                                <svg class="w-5 h-5 md:w-6 md:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2-2H7a2 2 0 00-2 2v4m14 0h2"/></svg>
                            </button>
                        </div>
                    </div>
                </div>
            `;
                }).join('');
            }

            function filterRecords() {
                const q = document.getElementById('search-input').value.toLowerCase();
                const filtered = employeeData.filter(e =>
                    String(e.Name || '').toLowerCase().includes(q) ||
                    String(e.City || '').toLowerCase().includes(q) ||
                    String(e.ID || '').toLowerCase().includes(q)
                );
                renderCards(filtered);
            }

            // --- MODAL & PRINT HANDLERS ---
            function openEditModal(index) {
                const e = employeeData[index];
                document.getElementById('edit-index').value = index;
                document.getElementById('edit-id').value = e.ID || '';
                document.getElementById('edit-name').value = e.Name || '';
                document.getElementById('edit-father').value = e["Father's Name"] || '';
                document.getElementById('edit-designation').value = e.Designation || '';
                document.getElementById('edit-city').value = e.City || '';
                const m = document.getElementById('edit-modal');
                const c = document.getElementById('edit-modal-content');
                m.classList.remove('hidden');
                setTimeout(() => { c.classList.remove('scale-95', 'opacity-0'); c.classList.add('scale-100', 'opacity-100'); }, 10);
            }

            function closeEditModal() {
                const c = document.getElementById('edit-modal-content');
                c.classList.remove('scale-100', 'opacity-100'); c.classList.add('scale-95', 'opacity-0');
                setTimeout(() => document.getElementById('edit-modal').classList.add('hidden'), 300);
            }

            function saveEdit() {
                const idx = document.getElementById('edit-index').value;
                employeeData[idx] = {
                    ID: document.getElementById('edit-id').value,
                    Name: document.getElementById('edit-name').value,
                    "Father's Name": document.getElementById('edit-father').value,
                    Designation: document.getElementById('edit-designation').value,
                    City: document.getElementById('edit-city').value
                };
                renderCards(employeeData); closeEditModal();
            }

            function confirmPrintByIndex(index) {
                currentPrintTarget = employeeData[index];
                const pexId = pexelsPortraitIds[index % pexelsPortraitIds.length];
                currentPrintImage = `https://images.pexels.com/photos/${pexId}/pexels-photo-${pexId}.jpeg?auto=compress&cs=tinysrgb&w=400&h=400&fit=crop`;
                document.getElementById('target-employee').innerText = currentPrintTarget.Name;
                const m = document.getElementById('print-modal');
                const c = document.getElementById('modal-content');
                m.classList.remove('hidden');
                setTimeout(() => { c.classList.remove('scale-95', 'opacity-0'); c.classList.add('scale-100', 'opacity-100'); }, 10);
            }

            function closeModal() {
                const c = document.getElementById('modal-content');
                c.classList.remove('scale-100', 'opacity-100'); c.classList.add('scale-95', 'opacity-0');
                setTimeout(() => document.getElementById('print-modal').classList.add('hidden'), 300);
            }

            function executePrint() {
                if (!currentPrintTarget) return;
                const area = document.getElementById('print-area');
                const today = new Date().toLocaleDateString('en-GB');
                area.innerHTML = `
                <div style="font-family: sans-serif; padding: 20px; border: 1px solid #eee;">
                    <div style="display: flex; justify-content: space-between; align-items: center; border-bottom: 4px solid #4f46e5; padding-bottom: 20px; margin-bottom: 40px;">
                        <div><h1 style="font-size: 28px; margin: 0;">EXCEL TRIAL</h1><p style="font-size: 12px; color: #64748b;">OFFICIAL RECORD</p></div>
                        <div style="text-align: right;"><p style="font-size: 10px; color: #94a3b8; margin: 0;">REF: ${Math.random().toString(36).substr(2, 9).toUpperCase()}</p><p style="font-size: 10px; color: #94a3b8; margin: 0;">${today}</p></div>
                    </div>
                    <div style="display: flex; gap: 40px; margin-bottom: 50px;">
                        <div style="width: 140px; height: 160px; border-radius: 12px; overflow: hidden;"><img src="${currentPrintImage}" style="width: 100%; height: 100%; object-fit: cover;"></div>
                        <div style="flex: 1;">
                            <h2 style="font-size: 18px; color: #4f46e5; border-bottom: 1px solid #f1f5f9; padding-bottom: 8px;">Employee Profile</h2>
                            <table style="width: 100%; font-size: 14px; border-collapse: collapse;">
                                <tr><td style="padding: 10px 0; border-bottom: 1px solid #f8fafc; color: #64748b;">Employee ID</td><td style="padding: 10px 0; border-bottom: 1px solid #f8fafc; font-weight: bold;">${currentPrintTarget.ID || '-'}</td></tr>
                                <tr><td style="padding: 10px 0; border-bottom: 1px solid #f8fafc; color: #64748b;">Full Name</td><td style="padding: 10px 0; border-bottom: 1px solid #f8fafc; font-weight: bold;">${currentPrintTarget.Name || '-'}</td></tr>
                                <tr><td style="padding: 10px 0; border-bottom: 1px solid #f8fafc; color: #64748b;">Designation</td><td style="padding: 10px 0; border-bottom: 1px solid #f8fafc; font-weight: bold;">${currentPrintTarget.Designation || '-'}</td></tr>
                                <tr><td style="padding: 10px 0; border-bottom: 1px solid #f8fafc; color: #64748b;">City</td><td style="padding: 10px 0; border-bottom: 1px solid #f8fafc; font-weight: bold;">${currentPrintTarget.City || '-'}</td></tr>
                            </table>
                        </div>
                    </div>
                    <div style="margin-top: 100px; display: flex; justify-content: space-between;"><div style="width: 180px; border-top: 1px solid #334155; text-align: center; font-size: 12px; padding-top: 8px;">Signature</div><div style="width: 180px; border-top: 1px solid #334155; text-align: center; font-size: 12px; padding-top: 8px;">Official Seal</div></div>
                </div>`;
                setTimeout(() => { window.print(); closeModal(); }, 150);
            }

            window.onload = () => {
                const demo = [
                    { ID: "AR-2001", Name: "Abdul Razak", "Father's Name": "Abdul Hakeem", Designation: "Senior Web Developer", City: "Daharki" },
                    { ID: "AN-2002", Name: "Abdul Nasir", "Father's Name": "Abdul Hakeem", Designation: "QA Officer", City: "Karachi" }
                ];
                employeeData = demo; renderCards(employeeData);
                startTypewriter();
                setInterval(animateFavicon, 60);
            };
        </script>
    </body>

</html>